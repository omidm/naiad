<html><head><title>Naiad Tutorial</title><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">.lst-kix_5mngloxrfyj4-4>li:before{content:"\0025cb  "}.lst-kix_6hvo93870h7q-1>li:before{content:"\0025cb  "}.lst-kix_m60igap0nk34-7>li:before{content:"\0025cb  "}.lst-kix_5mngloxrfyj4-7>li:before{content:"\0025cb  "}.lst-kix_xc5szr6vang3-8>li:before{content:"\0025a0  "}.lst-kix_m60igap0nk34-1>li:before{content:"\0025cb  "}.lst-kix_3sz5fw3jyfc0-0>li:before{content:"\0025cf  "}.lst-kix_v15u5gue0x74-0>li:before{content:"\0025cf  "}.lst-kix_2iq53x56wc0z-1>li:before{content:"\0025cb  "}.lst-kix_6hvo93870h7q-4>li:before{content:"\0025cb  "}.lst-kix_6hvo93870h7q-3>li:before{content:"\0025cf  "}.lst-kix_82u5z532ki8m-7>li:before{content:"\0025cb  "}.lst-kix_6hvo93870h7q-6>li:before{content:"\0025cf  "}.lst-kix_5mngloxrfyj4-8>li:before{content:"\0025a0  "}.lst-kix_xc5szr6vang3-6>li:before{content:"\0025cf  "}.lst-kix_82u5z532ki8m-1>li:before{content:"\0025cb  "}.lst-kix_2iq53x56wc0z-7>li:before{content:"\0025cb  "}.lst-kix_6hvo93870h7q-5>li:before{content:"\0025a0  "}.lst-kix_6hvo93870h7q-0>li:before{content:"\0025cf  "}.lst-kix_m60igap0nk34-4>li:before{content:"\0025cb  "}.lst-kix_3sz5fw3jyfc0-6>li:before{content:"\0025cf  "}.lst-kix_2iq53x56wc0z-6>li:before{content:"\0025cf  "}ul.lst-kix_82u5z532ki8m-1{list-style-type:none}ul.lst-kix_82u5z532ki8m-0{list-style-type:none}.lst-kix_m60igap0nk34-5>li:before{content:"\0025a0  "}ul.lst-kix_82u5z532ki8m-5{list-style-type:none}ul.lst-kix_82u5z532ki8m-4{list-style-type:none}ul.lst-kix_82u5z532ki8m-3{list-style-type:none}ul.lst-kix_82u5z532ki8m-2{list-style-type:none}.lst-kix_3sz5fw3jyfc0-1>li:before{content:"\0025cb  "}ul.lst-kix_82u5z532ki8m-8{list-style-type:none}.lst-kix_s7hfsaiwuz2k-6>li:before{content:"\0025cf  "}ul.lst-kix_82u5z532ki8m-7{list-style-type:none}.lst-kix_m60igap0nk34-6>li:before{content:"\0025cf  "}ul.lst-kix_82u5z532ki8m-6{list-style-type:none}.lst-kix_m60igap0nk34-2>li:before{content:"\0025a0  "}.lst-kix_v15u5gue0x74-3>li:before{content:"\0025cf  "}.lst-kix_2iq53x56wc0z-4>li:before{content:"\0025cb  "}.lst-kix_xc5szr6vang3-7>li:before{content:"\0025cb  "}.lst-kix_2iq53x56wc0z-8>li:before{content:"\0025a0  "}.lst-kix_5mngloxrfyj4-2>li:before{content:"\0025a0  "}.lst-kix_6hvo93870h7q-8>li:before{content:"\0025a0  "}.lst-kix_3sz5fw3jyfc0-2>li:before{content:"\0025a0  "}ul.lst-kix_xc5szr6vang3-7{list-style-type:none}ul.lst-kix_m60igap0nk34-2{list-style-type:none}ul.lst-kix_xc5szr6vang3-8{list-style-type:none}ul.lst-kix_m60igap0nk34-1{list-style-type:none}ul.lst-kix_m60igap0nk34-0{list-style-type:none}ul.lst-kix_m60igap0nk34-6{list-style-type:none}.lst-kix_v15u5gue0x74-4>li:before{content:"\0025cb  "}ul.lst-kix_m60igap0nk34-5{list-style-type:none}ul.lst-kix_m60igap0nk34-4{list-style-type:none}.lst-kix_2iq53x56wc0z-5>li:before{content:"\0025a0  "}ul.lst-kix_m60igap0nk34-3{list-style-type:none}.lst-kix_82u5z532ki8m-4>li:before{content:"\0025cb  "}.lst-kix_2iq53x56wc0z-0>li:before{content:"\0025cf  "}.lst-kix_82u5z532ki8m-8>li:before{content:"\0025a0  "}.lst-kix_v15u5gue0x74-7>li:before{content:"\0025cb  "}.lst-kix_s7hfsaiwuz2k-0>li:before{content:"\0025cf  "}.lst-kix_3sz5fw3jyfc0-3>li:before{content:"\0025cf  "}.lst-kix_3sz5fw3jyfc0-5>li:before{content:"\0025a0  "}ul.lst-kix_s7hfsaiwuz2k-8{list-style-type:none}ul.lst-kix_s7hfsaiwuz2k-7{list-style-type:none}ul.lst-kix_s7hfsaiwuz2k-6{list-style-type:none}ul.lst-kix_s7hfsaiwuz2k-5{list-style-type:none}ul.lst-kix_s7hfsaiwuz2k-0{list-style-type:none}.lst-kix_5mngloxrfyj4-6>li:before{content:"\0025cf  "}ul.lst-kix_s7hfsaiwuz2k-1{list-style-type:none}ul.lst-kix_s7hfsaiwuz2k-2{list-style-type:none}ul.lst-kix_s7hfsaiwuz2k-3{list-style-type:none}ul.lst-kix_s7hfsaiwuz2k-4{list-style-type:none}.lst-kix_m60igap0nk34-0>li:before{content:"\0025cf  "}.lst-kix_82u5z532ki8m-5>li:before{content:"\0025a0  "}.lst-kix_xc5szr6vang3-1>li:before{content:"\0025cb  "}.lst-kix_v15u5gue0x74-2>li:before{content:"\0025a0  "}.lst-kix_s7hfsaiwuz2k-8>li:before{content:"\0025a0  "}.lst-kix_2iq53x56wc0z-2>li:before{content:"\0025a0  "}.lst-kix_v15u5gue0x74-1>li:before{content:"\0025cb  "}.lst-kix_82u5z532ki8m-6>li:before{content:"\0025cf  "}.lst-kix_6hvo93870h7q-7>li:before{content:"\0025cb  "}.lst-kix_5mngloxrfyj4-0>li:before{content:"\0025cf  "}.lst-kix_82u5z532ki8m-0>li:before{content:"\0025cf  "}.lst-kix_xc5szr6vang3-0>li:before{content:"\0025cf  "}.lst-kix_6hvo93870h7q-2>li:before{content:"\0025a0  "}ul.lst-kix_v15u5gue0x74-7{list-style-type:none}ul.lst-kix_2iq53x56wc0z-2{list-style-type:none}ul.lst-kix_6hvo93870h7q-4{list-style-type:none}ul.lst-kix_v15u5gue0x74-8{list-style-type:none}ul.lst-kix_2iq53x56wc0z-3{list-style-type:none}ul.lst-kix_6hvo93870h7q-3{list-style-type:none}.lst-kix_5mngloxrfyj4-3>li:before{content:"\0025cf  "}ul.lst-kix_2iq53x56wc0z-4{list-style-type:none}ul.lst-kix_6hvo93870h7q-6{list-style-type:none}.lst-kix_v15u5gue0x74-5>li:before{content:"\0025a0  "}ul.lst-kix_2iq53x56wc0z-5{list-style-type:none}ul.lst-kix_6hvo93870h7q-5{list-style-type:none}ul.lst-kix_2iq53x56wc0z-6{list-style-type:none}ul.lst-kix_6hvo93870h7q-8{list-style-type:none}ul.lst-kix_2iq53x56wc0z-7{list-style-type:none}ul.lst-kix_6hvo93870h7q-7{list-style-type:none}ul.lst-kix_2iq53x56wc0z-8{list-style-type:none}ul.lst-kix_v15u5gue0x74-0{list-style-type:none}ul.lst-kix_v15u5gue0x74-1{list-style-type:none}ul.lst-kix_v15u5gue0x74-2{list-style-type:none}ul.lst-kix_v15u5gue0x74-3{list-style-type:none}ul.lst-kix_6hvo93870h7q-0{list-style-type:none}ul.lst-kix_v15u5gue0x74-4{list-style-type:none}.lst-kix_3sz5fw3jyfc0-8>li:before{content:"\0025a0  "}ul.lst-kix_v15u5gue0x74-5{list-style-type:none}.lst-kix_3sz5fw3jyfc0-4>li:before{content:"\0025cb  "}ul.lst-kix_2iq53x56wc0z-0{list-style-type:none}ul.lst-kix_6hvo93870h7q-2{list-style-type:none}ul.lst-kix_v15u5gue0x74-6{list-style-type:none}ul.lst-kix_2iq53x56wc0z-1{list-style-type:none}ul.lst-kix_6hvo93870h7q-1{list-style-type:none}ul.lst-kix_3sz5fw3jyfc0-2{list-style-type:none}ul.lst-kix_3sz5fw3jyfc0-3{list-style-type:none}.lst-kix_82u5z532ki8m-2>li:before{content:"\0025a0  "}ul.lst-kix_3sz5fw3jyfc0-0{list-style-type:none}.lst-kix_5mngloxrfyj4-1>li:before{content:"\0025cb  "}ul.lst-kix_3sz5fw3jyfc0-1{list-style-type:none}.lst-kix_s7hfsaiwuz2k-1>li:before{content:"\0025cb  "}.lst-kix_s7hfsaiwuz2k-4>li:before{content:"\0025cb  "}.lst-kix_v15u5gue0x74-8>li:before{content:"\0025a0  "}.lst-kix_xc5szr6vang3-3>li:before{content:"\0025cf  "}.lst-kix_82u5z532ki8m-3>li:before{content:"\0025cf  "}.lst-kix_xc5szr6vang3-2>li:before{content:"\0025a0  "}.lst-kix_m60igap0nk34-3>li:before{content:"\0025cf  "}.lst-kix_s7hfsaiwuz2k-5>li:before{content:"\0025a0  "}.lst-kix_3sz5fw3jyfc0-7>li:before{content:"\0025cb  "}ul.lst-kix_5mngloxrfyj4-3{list-style-type:none}ul.lst-kix_5mngloxrfyj4-2{list-style-type:none}ul.lst-kix_3sz5fw3jyfc0-8{list-style-type:none}ul.lst-kix_5mngloxrfyj4-5{list-style-type:none}ul.lst-kix_5mngloxrfyj4-4{list-style-type:none}ul.lst-kix_3sz5fw3jyfc0-5{list-style-type:none}ul.lst-kix_3sz5fw3jyfc0-4{list-style-type:none}ul.lst-kix_5mngloxrfyj4-1{list-style-type:none}ul.lst-kix_3sz5fw3jyfc0-7{list-style-type:none}ul.lst-kix_5mngloxrfyj4-0{list-style-type:none}ul.lst-kix_3sz5fw3jyfc0-6{list-style-type:none}.lst-kix_xc5szr6vang3-5>li:before{content:"\0025a0  "}.lst-kix_s7hfsaiwuz2k-3>li:before{content:"\0025cf  "}.lst-kix_2iq53x56wc0z-3>li:before{content:"\0025cf  "}ul.lst-kix_5mngloxrfyj4-6{list-style-type:none}ul.lst-kix_5mngloxrfyj4-7{list-style-type:none}.lst-kix_m60igap0nk34-8>li:before{content:"\0025a0  "}ul.lst-kix_5mngloxrfyj4-8{list-style-type:none}ul.lst-kix_xc5szr6vang3-6{list-style-type:none}.lst-kix_s7hfsaiwuz2k-7>li:before{content:"\0025cb  "}ul.lst-kix_xc5szr6vang3-5{list-style-type:none}.lst-kix_5mngloxrfyj4-5>li:before{content:"\0025a0  "}ul.lst-kix_xc5szr6vang3-4{list-style-type:none}.lst-kix_s7hfsaiwuz2k-2>li:before{content:"\0025a0  "}ul.lst-kix_xc5szr6vang3-3{list-style-type:none}ul.lst-kix_xc5szr6vang3-2{list-style-type:none}ul.lst-kix_m60igap0nk34-7{list-style-type:none}ul.lst-kix_xc5szr6vang3-1{list-style-type:none}ul.lst-kix_m60igap0nk34-8{list-style-type:none}.lst-kix_xc5szr6vang3-4>li:before{content:"\0025cb  "}ul.lst-kix_xc5szr6vang3-0{list-style-type:none}.lst-kix_v15u5gue0x74-6>li:before{content:"\0025cf  "}ol{margin:0;padding:0}.c1{padding-left:0pt;widows:2;orphans:2;direction:ltr;margin-left:36pt}.c2{widows:2;orphans:2;height:11pt;direction:ltr}.c3{widows:2;orphans:2;direction:ltr}.c11{max-width:481.9pt;background-color:#ffffff;padding:56.7pt 56.7pt 56.7pt 56.7pt}.c8{color:inherit;text-decoration:inherit}.c10{font-size:15pt;background-color:#ffffff}.c6{color:#1155cc;text-decoration:underline}.c0{margin:0;padding:0}.c9{page-break-after:avoid}.c7{font-weight:bold}.c5{margin-left:18pt}.c4{margin-left:36pt}.title{widows:2;padding-top:0pt;line-height:1.15;orphans:2;text-align:left;color:#000000;font-size:21pt;font-family:"Trebuchet MS";padding-bottom:0pt;page-break-after:avoid}.subtitle{widows:2;padding-top:0pt;line-height:1.15;orphans:2;text-align:left;color:#666666;font-style:italic;font-size:13pt;font-family:"Trebuchet MS";padding-bottom:10pt;page-break-after:avoid}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{widows:2;padding-top:10pt;line-height:1.15;orphans:2;text-align:left;color:#000000;font-size:16pt;font-family:"Trebuchet MS";padding-bottom:0pt;page-break-after:avoid}h2{widows:2;padding-top:10pt;line-height:1.15;orphans:2;text-align:left;color:#000000;font-size:13pt;font-family:"Trebuchet MS";font-weight:bold;padding-bottom:0pt;page-break-after:avoid}h3{widows:2;padding-top:8pt;line-height:1.15;orphans:2;text-align:left;color:#666666;font-size:12pt;font-family:"Trebuchet MS";font-weight:bold;padding-bottom:0pt;page-break-after:avoid}h4{widows:2;padding-top:8pt;line-height:1.15;orphans:2;text-align:left;color:#666666;font-size:11pt;text-decoration:underline;font-family:"Trebuchet MS";padding-bottom:0pt;page-break-after:avoid}h5{widows:2;padding-top:8pt;line-height:1.15;orphans:2;text-align:left;color:#666666;font-size:11pt;font-family:"Trebuchet MS";padding-bottom:0pt;page-break-after:avoid}h6{widows:2;padding-top:8pt;line-height:1.15;orphans:2;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Trebuchet MS";padding-bottom:0pt;page-break-after:avoid}</style></head><body class="c11"><p class="c3"><span class="c7 c10">Data Flow Programming Tutorial (NAIAD)</span></p><p class="c2"><span class="c10 c7"></span></p><p class="c3 c5"><span class="c6"><a class="c8" href="#h.6ctumsxvv315">Setting up an EC2 instance</a></span></p><p class="c3 c5"><span class="c6"><a class="c8" href="#h.rjodetcn01e3">Authoring a Naiad program</a></span></p><p class="c3 c5"><span class="c6"><a class="c8" href="#h.wznf1obioaj1">Using the Naiad library</a></span></p><p class="c3 c5"><span class="c6"><a class="c8" href="#h.sb62fof1t2dd">Running jobs on a cluster</a></span></p><p class="c3 c5"><span class="c6"><a class="c8" href="#h.qky47749cygs">Extensions</a></span></p><p class="c2"><span></span></p><p class="c2"><span></span></p><p class="c3"><span>In
 this tutorial, we will learn how to make use of the Naiad distributed 
computation framework on Amazon’s cloud computing platform.</span></p><p class="c2"><span></span></p><h1 class="c3 c9"><a name="h.6ctumsxvv315"></a><span>Setting up an EC2 instance</span></h1><p class="c3"><span>You
 should have received some instructions containing a link to a tarball 
that holds the necessary files for this tutorial. Inside the archive you
 will find:</span></p><p class="c2"><span></span></p><ul class="c0 lst-kix_3sz5fw3jyfc0-0 start"><li class="c1"><span>EC2 API command line tools</span></li><li class="c1"><span>Security certificates for connecting to AWS</span></li><li class="c1"><span>Scripts for setting up the environment</span></li></ul><p class="c2"><span></span></p><p class="c3"><span>You
 will first need to extract the contents of the archive to a folder on 
your local machine. This will create a folder named ec2-bin. The 
ec2-config.sh script defines a set of environment variables that are 
needed in order to utilise the EC2 command line tools.</span></p><p class="c2"><span></span></p><p class="c3 c4"><span class="c7">tar zxf &lt;tarball&gt;.tgz<br>cd ec2-bin<br>. ec2-config.sh<br></span><span>(NB that’s a dot followed by the script)</span></p><p class="c2"><span></span></p><p class="c3"><span>You
 may need to alter the ec2-config.sh script to point to the location of 
the Java Runtime Environment on your machine (which is used by the EC2 
API tools).</span></p><p class="c2"><span></span></p><p class="c3"><span>The
 environment variables have now been loaded into the current shell 
session. The next step is to create a personal private key for your own 
cluster. The following command will request and download a private key 
with the filename pk-[userid] into the current folder.</span></p><p class="c3 c4"><span class="c7">./create-key.sh pk-$USER<br></span></p><p class="c3"><span>Your machine</span><span>&nbsp;will
 be distinguished from other students' machines using this private key. 
The next step is to actually provision the cluster.</span></p><p class="c3 c4"><span class="c7">./cluster-setup.sh pk-$USER</span><span><br></span></p><p class="c3"><span>The
 above command will request an "on-demand" instance and provision it 
with a basic Ubuntu system image. For this tutorial, only "micro" 
instances with minimal resources will be used. The script creates three 
files in the local directory:</span></p><p class="c2"><span></span></p><ul class="c0 lst-kix_xc5szr6vang3-0 start"><li class="c1"><span>hosts-pub - contains the public DNS hostnames of each instance</span></li><li class="c1"><span>hosts-prv - contains the private (EC2 internal) hostnames of each instance</span></li><li class="c1"><span>hosts-ins - contains the instance IDs utilised by the EC2 API for each instance</span></li></ul><p class="c2"><span></span></p><p class="c3"><span>After the command has completed, the request will take some further time to process (usually a few seconds). </span></p><p class="c3"><span>Following the successful completion of the software deployment process, we can connect to the machine. </span></p><p class="c3 c4"><span class="c7">master=`cat hosts-pub`<br>ssh -i pk-$USER ubuntu@$master<br></span></p><p class="c3"><span>Y</span><span>ou
 will be connected to your virtual machine, and have full sudo access. 
You may want to install some additional packages using sudo apt-get 
install. The nano and vim text editors are installed by default, and 
these can be used to perform the tasks in the tutorial. Alternatively, 
you can edit files locally on your machine, and copy to/from your EC2 
instances using scp.</span></p><p class="c2"><span></span></p><p class="c3"><span>Once
 your instance is running, you will need to install Mono to compile and 
run Naiad programs. Run the following while logged into your instance:</span></p><p class="c2"><span></span></p><p class="c3 c4"><span class="c7">sudo apt-get install mono-complete</span></p><p class="c2"><span></span></p><p class="c3"><span>We can then download and build Naiad from the GitHub repository:</span></p><p class="c2"><span></span></p><p class="c3 c4"><span class="c7">sudo apt-get install git</span></p><p class="c3 c4"><span class="c7">git clone </span><span class="c6 c7"><a class="c8" href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2FMicrosoftResearch%2FNaiad.git&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHOhSaqOaJe_Qj2G-kZjV6vp1CwAQ">https://github.com/MicrosoftResearch/Naiad.git</a></span></p><p class="c3 c4"><span class="c7">cd Naiad</span></p><p class="c3 c4"><span class="c7">git checkout tags/v0.4.2</span></p><p class="c3 c4"><span class="c7">sh ./build_mono.sh</span></p><p class="c2"><span class="c7"></span></p><p class="c3"><span>To
 begin with, you will utilise a single EC2 instance to familiarise 
yourself with Naiad. Later in the tutorial, we will join the collective 
instances together to form a cluster.</span></p><p class="c2"><span></span></p><h1 class="c3 c9"><a name="h.rjodetcn01e3"></a><span>Authoring a Naiad program</span></h1><p class="c3"><span>Documentation
 for the Naiad SDK library is available at the following URL 
(alternatively, it can be built directly from the source code, if you 
have access to Visual Studio).</span></p><p class="c2"><span></span></p><p class="c3 c4"><span class="c6"><a class="c8" href="http://www.google.com/url?q=http%3A%2F%2Fmicrosoftresearch.github.io%2FNaiad%2F&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNFgvIyQhuveNaq6VOib5EUUValakw">http://microsoftresearch.github.io/Naiad/</a></span></p><p class="c2"><span></span></p><p class="c3"><span>To
 begin with, read through “Writing your first Naiad program”. &nbsp;At a
 low level, Naiad programs consist of dataflow vertices (also known as 
“operators”), which are composed into partitioned segments called 
“stages”. Notice however that none of this terminology is used in the 
source code on that page. This is because Naiad provides a number of 
wrappers around these basic building blocks for the sake of convenience.
 A number of higher-level languages (or DSLs) are also provided within 
the Naiad library. </span></p><p class="c2"><span></span></p><p class="c3"><span>See
 if you can build and run the example source code on that page. Note 
that you will need to include a few more lines for syntactic 
correctness.</span></p><p class="c2"><span></span></p><p class="c3"><span>To
 compile the program, copy the Naiad core library built earlier into the
 same directory as your source code (it should be in 
~/Naiad/Naiad/bin/Debug/Microsoft.Research.Naiad.dll).</span></p><p class="c2"><span></span></p><p class="c3"><span>Then use the following command:</span></p><p class="c2"><span></span></p><p class="c3 c4"><span class="c7">dmcs &lt;program.cs&gt; /reference:Microsoft.Research.Naiad.dll</span></p><p class="c2"><span class="c7"></span></p><p class="c3"><span>Replace the filename with the name of your source file. If it compiles successfully, you can execute the program using:</span></p><p class="c2"><span></span></p><p class="c3 c4"><span class="c7">mono &lt;program.exe&gt;</span></p><p class="c2"><span></span></p><h1 class="c3 c9"><a name="h.wznf1obioaj1"></a><span>Using the Naiad library</span></h1><p class="c3"><span>Depending
 on the level of customisation required, there are a number of different
 ways to utilise the library. We will examine a few of the Naiad example
 programs to highlight the various approaches. Source code for the 
examples can be found by navigating to the following directory:</span></p><p class="c2"><span></span></p><p class="c3 c4"><span class="c7">cd ~/Naiad/Examples</span></p><p class="c2"><span></span></p><p class="c3"><span>To begin with, look at the “Throughput” example (</span><span class="c7">Examples/Naiad/Throughput.cs</span><span>).
 This example is designed to test the limits of the Naiad pipeline, by 
pumping messages as quickly as possible between two trivial dataflow 
vertices. In this example, the “producer” and “consumer” vertices are 
created by subclassing the standard “Vertex” abstract class. </span></p><p class="c2"><span></span></p><p class="c3"><span>Examine the source code and try to answer these questions:</span></p><ul class="c0 lst-kix_82u5z532ki8m-0 start"><li class="c1"><span>What is the purpose of the OnNotify / OnRecv methods in the producer and consumer?</span></li><li class="c1"><span>What is the purpose of the MakeStage methods?</span></li><li class="c1"><span>What does the VertexLocation do? What is the pattern of communication among these processes?</span></li><li class="c1"><span>How could the program be modified to achieve a “shuffle”-style communication pattern?</span></li></ul><p class="c2"><span></span></p><p class="c3"><span>In
 most cases, it won’t be necessary to to construct custom vertices in 
this manner. Instead, a number of general-purpose dataflow vertices are 
available, which allow the developer to focus on the actual computation 
rather than the distribution mechanism. </span></p><p class="c2"><span></span></p><p class="c3"><span>Now look at the “Wordcount” example in the same directory (</span><span class="c7">Examples/Naiad/Wordcount.cs</span><span>). This example makes use of the C# “extension method” syntax (described further on </span><span class="c6"><a class="c8" href="http://www.google.com/url?q=http%3A%2F%2Fmsdn.microsoft.com%2Fen-GB%2Flibrary%2Fbb383977.aspx&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNGv-KvmPTVtAU72oGCoNH7XVgpVMQ">MSDN</a></span><span>).
 Instead of overriding the entire class, this allows the developer to 
make use of a generic “Unary vertex” operator, and define a custom 
method to perform the actual computation.</span></p><p class="c2"><span></span></p><ul class="c0 lst-kix_m60igap0nk34-0 start"><li class="c1"><span>Find the definition of “StreamingCount”. How is it invoked? What does it do?</span></li></ul><p class="c2"><span></span></p><p class="c3"><span>The same example is also implemented separately using “NaiadLINQ”, in the differential dataflow examples directory (</span><span class="c7">Examples/DifferentialDataflow/Wordcount.cs</span><span>).
 LINQ (Language-INtegrated Query) is a DSL that defines a number of 
relational-style operations on input streams. These operators have been 
implemented in the Naiad framework, using the approaches defined above.</span></p><p class="c2"><span></span></p><ul class="c0 lst-kix_2iq53x56wc0z-0 start"><li class="c1"><span>Compare the two implementations of Wordcount - how does the LINQ query map to the extension method defined earlier?</span></li></ul><p class="c2"><span></span></p><p class="c2 c4"><span class="c7"></span></p><h1 class="c3 c9"><a name="h.sb62fof1t2dd"></a><span>Running jobs on a cluster</span></h1><p class="c3"><span>Notice
 that each example program is instantiated using a “Computation” object.
 The “FromArgs” method allows configuration parameters to be passed to 
the Naiad execution engine. It is also possible to run multiple 
computations using a “Controller” object. Run the Examples.exe program 
without parameters to see a listing of Naiad engine options.</span></p><p class="c2"><span></span></p><p class="c3"><span>To
 run a multi-machine distributed computation, it is necessary to copy 
the executable to each machine, and launch each instance with a separate
 process ID (the -p option). </span></p><ul class="c0 lst-kix_5mngloxrfyj4-0 start"><li class="c1"><span>Find a partner and exchange your SSH public keys (in ~/.ssh/authorized_keys)</span></li><li class="c1"><span>You
 will need to set up a separate directory to store your program on the 
remote machine (to avoid overwriting each other’s files). Remember to 
copy the Naiad DLL. </span></li><li class="c1"><span>Simply prepend ssh 
&lt;remote_machine&gt; to the command line, in order to launch it on the
 remote machine. It may be necessary to disable firewalls on either 
side. </span></li><li class="c1"><span>By repeating this process with other pairs, the size of the cluster can be expanded.</span></li></ul><p class="c2"><span></span></p><p class="c3"><span>This
 approach is somewhat cumbersome, however, Naiad also contains library 
hooks to allow programs to make use of Windows Azure compute and storage
 directly from source.</span></p><p class="c2"><span></span></p><h1 class="c3 c9"><a name="h.qky47749cygs"></a><span>Extensions</span></h1><p class="c3"><span>In
 this section we will make use of the concepts introduced thus far to 
design a more realistic dataflow computation. Twitter exposes a 
streaming API that allows developers to download public tweets as they 
are published. These streams are marked up using JSON syntax. The 
following commands will give you access to a set of files containing 
data recently downloaded from Twitter (you will need to substitute 
[SERVER] with a hostname provided by the supervisor).</span></p><p class="c2"><span></span></p><p class="c3 c4"><span class="c7">apt-get install nfs-common<br>modprobe nfs<br>mkdir pubstore<br>mount [SERVER]:/pubstore pubstore</span></p><p class="c2 c4"><span class="c7"></span></p><p class="c3"><span>The pubstore directory will now contain several text files, each filled with approximately 100MB of tweets in JSON format. </span></p><p class="c2"><span></span></p><p class="c3"><span>Using
 the LINQ-based Wordcount example as a template, try to write a program 
that calculates the most popular hash tags in the downloaded sample. You
 will have to do the following:</span></p><ul class="c0 lst-kix_s7hfsaiwuz2k-0 start"><li class="c1"><span>Wrap the file in an input stream.</span></li><li class="c1"><span>Select and filter all hash tags (if present)</span></li><li class="c1"><span>Group and count the distinct hashes</span></li><li class="c1"><span>Output the top 10 (or however many you want)</span></li></ul><p class="c2"><span></span></p><p class="c3"><span>Once
 you are satisfied that it is working in LINQ, try to implement the 
hashtag counter using extension methods (as in the second example 
above). </span></p><p class="c2"><span></span></p><p class="c3"><span>Once
 you have both versions of the program working, use the method described
 in the previous section to run the computation on multiple machines. 
Have each machine process a separate chunk of the file. Compare the 
runtime performance of the LINQ-based and extension-method 
implementations.</span></p></body></html>